<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>【网络编程】基于TCP/IP协议的C/S模型 | 半生瓜のblog</title><meta name="keywords" content="-C语言,-笔记,-网络编程"><meta name="author" content="Do2eM0N"><meta name="copyright" content="Do2eM0N"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="相关视频——C3程序猿-windows网络编程：第一部分tcp&#x2F;ip 基于TCP&#x2F;IP协议的C&#x2F;S模型TCP&#x2F;IP协议全称——Transmission Control Protocol &#x2F; Internet Protocol 重要性——TCP&#x2F;IP协议是今天互联网的基石，没有这个就上不了网 概念——TCP&#x2F;IP协议族(簇，组，体系），并不是TCP协议和IP协议的总称，指的是整个网络传输体系。而TC">
<meta property="og:type" content="article">
<meta property="og:title" content="【网络编程】基于TCP&#x2F;IP协议的C&#x2F;S模型">
<meta property="og:url" content="http://doraemon2.xyz/2021/08/26/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%9F%BA%E4%BA%8ETCPIP%E5%8D%8F%E8%AE%AE%E7%9A%84CS%E6%A8%A1%E5%9E%8B/index.html">
<meta property="og:site_name" content="半生瓜のblog">
<meta property="og:description" content="相关视频——C3程序猿-windows网络编程：第一部分tcp&#x2F;ip 基于TCP&#x2F;IP协议的C&#x2F;S模型TCP&#x2F;IP协议全称——Transmission Control Protocol &#x2F; Internet Protocol 重要性——TCP&#x2F;IP协议是今天互联网的基石，没有这个就上不了网 概念——TCP&#x2F;IP协议族(簇，组，体系），并不是TCP协议和IP协议的总称，指的是整个网络传输体系。而TC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://doraemon2.xyz/img/socket.png">
<meta property="article:published_time" content="2021-08-26T07:45:06.000Z">
<meta property="article:modified_time" content="2021-08-29T10:22:00.186Z">
<meta property="article:author" content="Do2eM0N">
<meta property="article:tag" content="-C语言">
<meta property="article:tag" content="-笔记">
<meta property="article:tag" content="-网络编程">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://doraemon2.xyz/img/socket.png"><link rel="shortcut icon" href="/img/doraemon2.png"><link rel="canonical" href="http://doraemon2.xyz/2021/08/26/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%9F%BA%E4%BA%8ETCPIP%E5%8D%8F%E8%AE%AE%E7%9A%84CS%E6%A8%A1%E5%9E%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4bd5c0d5704ac1dd90d20a471e6a167a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-29 18:22:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/xiaotubiao.css"><link rel="stylesheet" href="/footermeihua.css"><link rel="stylesheet" href="/css/hua.css"><link rel="stylesheet" href="/css/background.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/css/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiperstyle.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="半生瓜のblog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/doraemon2.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 伙伴</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/socket.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">半生瓜のblog</a><div id="tp-weather-widget"></div></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 伙伴</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【网络编程】基于TCP/IP协议的C/S模型</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-26T07:45:06.000Z" title="发表于 2021-08-26 15:45:06">2021-08-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-29T10:22:00.186Z" title="更新于 2021-08-29 18:22:00">2021-08-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">网络编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【网络编程】基于TCP/IP协议的C/S模型"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>相关视频——<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cb411w7sZ">C3程序猿-windows网络编程：第一部分tcp/ip</a></p>
<h1 id="基于TCP-IP协议的C-S模型"><a href="#基于TCP-IP协议的C-S模型" class="headerlink" title="基于TCP/IP协议的C/S模型"></a>基于TCP/IP协议的C/S模型</h1><h2 id="TCP-IP协议"><a href="#TCP-IP协议" class="headerlink" title="TCP/IP协议"></a>TCP/IP协议</h2><p><strong>全称</strong>——Transmission Control Protocol / Internet Protocol</p>
<p><strong>重要性</strong>——TCP/IP协议是今天互联网的基石，没有这个就上不了网</p>
<p><strong>概念</strong>——TCP/IP协议族(簇，组，体系），并不是TCP协议和IP协议的总称，指的是整个网络传输体系。而TCP协议和IP协议就是单单的两个协议。</p>
<p><strong>特点</strong>——<strong>面向可连接的，可靠的，基于数据报的传输协议层</strong>。</p>
<hr>
<p>UDP/IP协议——面向非连接的，不可靠的，基于数据报的传输层协议。</p>
<hr>
<h2 id="Client-Server客户端-服务器模型"><a href="#Client-Server客户端-服务器模型" class="headerlink" title="Client/Server客户端/服务器模型"></a>Client/Server客户端/服务器模型</h2><p>C/S模型其实是概念层面的，实现层面可以是基于任何的网络协议。</p>
<p>常见的还有B/S模型——浏览器/服务器模型，基于http/https协议的</p>
<h2 id="套接字编程与socket编程"><a href="#套接字编程与socket编程" class="headerlink" title="套接字编程与socket编程"></a>套接字编程与socket编程</h2><p>socket中文——套接字</p>
<p>统称网络编程</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul>
<li>局域网</li>
<li>广域网——内网穿透，内网转发</li>
</ul>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="网络头文件-amp-网络库"><a href="#网络头文件-amp-网络库" class="headerlink" title="网络头文件&amp;网络库"></a>网络头文件&amp;网络库</h3><p>是最底层的网络函数，QT、MFC、WPF等封装好的网络库都是对这些最本质的网络函数的二次封装。</p>
<p><strong>不区分大小写(windows)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="comment">//第二版的网络库，是一版的升级优化版本</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"><span class="comment">//.lib静态库后缀，是库文件，将.cpp文件编译为二进制文件</span></span><br><span class="line"><span class="comment">//好处:使用时无需编译，直接使用，解决时间</span></span><br><span class="line"><span class="comment">//32位编译环境和64位编译环境都用这个，没有ws2_64</span></span><br></pre></td></tr></table></figure>

<h3 id="打开网络库"><a href="#打开网络库" class="headerlink" title="打开网络库"></a>打开网络库</h3><p><strong>功能</strong>：</p>
<p>打开网络库/启动网络库，启动了这个库，库里的函数才能使用，功能才能实现。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">WSAStarp</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">WORD wVersionRequired,</span></span></span><br><span class="line"><span class="function"><span class="params">LPWSADATA lpWSAData</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;  </span><br></pre></td></tr></table></figure>

<h4 id="参数1"><a href="#参数1" class="headerlink" title="参数1"></a>参数1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参数<span class="number">1</span>-使用哪个版本的网络库-WORD-无符号<span class="keyword">short</span></span><br><span class="line">    WORD wdVersion = MAKEWORD(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//主版本号2存在低数据位，副版本号1存在高数据位</span></span><br></pre></td></tr></table></figure>

<hr>
<p>（<strong>参数前面有lp传地址</strong>）</p>
<hr>
<h4 id="参数2"><a href="#参数2" class="headerlink" title="参数2"></a>参数2</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">参数<span class="number">2</span>-创建一个结构体，传递给系统，系统将信息放到结构体中，函数调用之后在外面通过结构体查看系统传递给我们的信息。</span><br><span class="line">********************************************************************************</span><br><span class="line">    WSADATA wdSockMsg;</span><br><span class="line">********************************************************************************</span><br><span class="line">其中包括</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">WSAData</span> &#123;</span></span><br><span class="line">        WORD                    wVersion;<span class="comment">//我们要使用的版本</span></span><br><span class="line">        WORD                    wHighVersion;<span class="comment">//系统能提供给我们的最高的版本</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">short</span>          iMaxSockets;<span class="comment">//返回可用的socket数量，2版本之后就没用了</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">short</span>          iMaxUdpDg;<span class="comment">//UDP数据报信息的大小，2版本之后就没用了</span></span><br><span class="line">        <span class="keyword">char</span> FAR *              lpVendorInfo;<span class="comment">//供应上特定的信息，2版本呢之后就没用 了</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">char</span>                    szDescription[WSADESCRIPTION_LEN+<span class="number">1</span>];<span class="comment">//当前库的描述信息，2.0是第二版的意思</span></span><br><span class="line">        <span class="keyword">char</span>                    szSystemStatus[WSASYS_STATUS_LEN+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">char</span>                    szDescription[WSADESCRIPTION_LEN+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">char</span>                    szSystemStatus[WSASYS_STATUS_LEN+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">********************************************************************************</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">********************************************************************************</span><br><span class="line">	WSAStartup(wdVersion,&amp;wdSockMsg);</span><br><span class="line">********************************************************************************</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">当输入的版本不存在</span><br><span class="line">    例如:</span><br><span class="line">    <span class="number">1.3</span> <span class="number">2.3</span>——有主版本，没有副版本 得到主版本的的最大副版本 <span class="number">1.1</span> <span class="number">2.2</span>并使用</span><br><span class="line">    <span class="number">3.1</span> <span class="number">3.3</span>——超过最大版 本号，使用系统能提供的最大版本<span class="number">2.2</span></span><br><span class="line">    <span class="number">0.0</span> <span class="number">0.1</span> <span class="number">0.3</span>——主版本是<span class="number">0</span>，不支持请求的套接字版本</span><br></pre></td></tr></table></figure>



<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p><strong>每一种错误有它唯一的对应码</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (nRes != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;网络库打开失败&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">返回值-成功返回<span class="number">0</span></span><br><span class="line">	 -失败返回对应错误的宏</span><br><span class="line">    WSASYSNOTREADY   <span class="number">10091</span> </span><br><span class="line">    	底层网络子系统尚未准备好进行网络通信。                     		 </span><br><span class="line">    	系统配置问题，重启下电脑，检查ws2_32库是否存在，或者是否在环境配置目录下</span><br><span class="line">	WSAVERNOTSUPPORTED <span class="number">10092</span> </span><br><span class="line"> 		此特定Windows套接字实现不提供所请求的Windows套接字支持版本。      </span><br><span class="line">   		要使用的版本不支持</span><br><span class="line">	WSAEPROCLIM     <span class="number">10067</span>  </span><br><span class="line">    	已达到对Windows套接字实现支持的任务数量的限制。                                 	Windows Sockets实现可能限制同时使用它的应用程序的数量</span><br><span class="line">	WSAEINPROGRESS 	<span class="number">10036</span>          </span><br><span class="line">   		正在阻止Windows Sockets <span class="number">1.1</span>操作。                                                 当前函数运行期间，由于某些原因造成阻塞，会返回在这个错误码，其他操作均禁止</span><br><span class="line">	WSAEFAULT       <span class="number">10014</span>          </span><br><span class="line">    	lpWSAData参数不是有效指针。                                                                 参数写错了  </span><br></pre></td></tr></table></figure>



<h3 id="校验版本"><a href="#校验版本" class="headerlink" title="校验版本"></a>校验版本</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HIBYTE(wdSockMsg.wVersion) != <span class="number">2</span> || LOBYTE(wdSockMsg.wVersion) != <span class="number">2</span></span><br><span class="line">    HIBYTE是高位-副版本</span><br><span class="line">    LOBYTE是低位-主版本</span><br><span class="line">   例如:只要有一个不是<span class="number">2</span>，说明系统不支持我们要的<span class="number">2.2</span>版本</span><br><span class="line"></span><br><span class="line">       前面为主版本，后面为副版本</span><br><span class="line">       要打开<span class="number">2.1</span></span><br><span class="line">HIBYTE(wdSockMsg.wVersion) != <span class="number">1</span> &amp;&amp; LOBYTE(wdSockMsg.wVersion) != <span class="number">2</span></span><br><span class="line">       </span><br><span class="line">       如果版本不对</span><br><span class="line">       WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line">	   <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建socket"><a href="#创建socket" class="headerlink" title="创建socket"></a>创建socket</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SOCKET <span class="title">socket</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> af,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> type,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> protocol</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>例如</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SOCKET socketServer = socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br></pre></td></tr></table></figure>



<h4 id="什么是socket"><a href="#什么是socket" class="headerlink" title="什么是socket"></a><strong>什么是socket</strong></h4><p>将底层复杂的协议体系，执行流程，进行封装，封装完的结果，就是一个socket了。</p>
<p>也就是说，socket是我们调用协议进行通信的操作接口。</p>
<h4 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h4><p>将复杂的协议过程与编程人员分开，我们只需要操作一个简单那的SOCKET就行了，对于底层的协议过程细节，我们完全不用知道，这就大大的方便了我们。</p>
<p>网络编程难在协议本身的复杂性，简单在我们编程层面完全不用考虑哪些。</p>
<h4 id="本质"><a href="#本质" class="headerlink" title="本质"></a>本质</h4><p>就是一种数据类型。就是一个整数。</p>
<p><img src="/images/%E5%9F%BA%E4%BA%8ETCP-IP%E5%8D%8F%E8%AE%AE%E7%9A%84C-S%E6%A8%A1%E5%9E%8B.assets/image-20210823230157616.png" alt="image-20210823230157616"></p>
<p>socket的值是唯一的，通过这个值找到对应的协议。</p>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>网络通信的函数，全都要使用SOCKET,每个客户端有一个SOCKET，服务器有一个SOCKET，通信的时候，就需要这个SOCKET做参数，跟谁通信，就要传递谁的SOCKET。</p>
<p>SOCKET是网络封装的精华，写代码就是不停的使用SOCKET这个变量，所以又叫SOCKET编程。</p>
<h4 id="参数1-1"><a href="#参数1-1" class="headerlink" title="参数1"></a>参数1</h4><p><strong>地址的类型</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加入你要与好友取得联系，可以通过</span><br><span class="line">    电话、QQ、微信等方式</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AF_INET <span class="number">2</span></span><br><span class="line">    ipv4地址</span><br><span class="line">    Internet协议版本地址系列</span><br><span class="line">    例如:<span class="number">192.168</span><span class="number">.1</span><span class="number">.103</span></span><br><span class="line">        <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>~<span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line">        <span class="number">4</span>字节，<span class="number">32</span>位的地址</span><br><span class="line">        点分十进制表示法</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AF_INET6 <span class="number">23</span></span><br><span class="line">    ipv6地址</span><br><span class="line">    Internet协议版本地址系列</span><br><span class="line">    例如:<span class="number">2001</span>:<span class="number">0</span>:<span class="number">3238</span>:DFE1:<span class="number">63</span>::FEFB</span><br><span class="line">        <span class="number">16</span>字节，<span class="number">128</span>位地址</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AF_BTH <span class="number">32</span></span><br><span class="line">    蓝牙地址</span><br><span class="line">    例如:<span class="number">6B</span>:<span class="number">2</span>D:BC:A9:<span class="number">8</span>C:<span class="number">12</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AF_IRDA <span class="number">26</span></span><br><span class="line">    红外数据协会(lrDA)地址</span><br></pre></td></tr></table></figure>

<h4 id="参数2-1"><a href="#参数2-1" class="headerlink" title="参数2"></a>参数2</h4><p><strong>套接字类型</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SOCK_STREAM <span class="number">1</span></span><br><span class="line">    提供给带有OOB数据传输机制的顺序，可靠，双向，基于连接的字节流。</span><br><span class="line">    使用TCP作为internet地址系列AF_INET <span class="keyword">or</span> AF_INET6</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SOCK_DGRAM <span class="number">2</span></span><br><span class="line">    固定(通常很小)最大长度的无连接，不可靠的缓冲区。</span><br><span class="line">    使用UDP作为internet地址系列AF_INET <span class="keyword">or</span> AF_INET6</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOCK_RAW <span class="number">3</span></span><br><span class="line">    提供允许应用程序操作下一个上层协议头的原始套接字。 要操作IPv4标头，必须在套接字上设置IP_HDRINCL套接字选项。 要操作IPv6标头，必须在套接字上设置IPV6_HDRINCL套接字选项。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOCK_RDM <span class="number">4</span></span><br><span class="line">    提供可靠的消息数据报。 这种类型的一个示例是Windows中的实用通用多播（PGM）多播协议实现，通常称为可靠多播节目。仅在安装了可靠多播协议时才支持此类型值。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOCK_SEQPACKET <span class="number">5</span></span><br><span class="line">    提供基于数据报的伪流数据包。</span><br></pre></td></tr></table></figure>

<h4 id="参数3"><a href="#参数3" class="headerlink" title="参数3"></a>参数3</h4><p><strong>协议类型</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这个位置写<span class="number">0</span>是什么意思？</span><br><span class="line">    即系统给我们自动选择合适的协议。但不明确。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IPPROTO_TCP</span><br><span class="line">    传输控制协议（TCP）。 当af参数为AF_INET或AF_INET6且类型参数为SOCK_STREAM时，这是一个可能的值。</span><br><span class="line">    可能的值是什么意思？</span><br><span class="line">    如果有个协议TOP前两个参数也传这样的参数，此时(socket)第三个参数即写成IPPROTO_TOP</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IPPROTO_UDP </span><br><span class="line">    用户数据报协议（UDP）。 当af参数为AF_INET或AF_INET6且类型参数为SOCK_DGRAM时，这是一个可能的值。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IPPROTO_ICMP</span><br><span class="line">    Internet控制消息协议（ICMP）。 当af参数为AF_UNSPEC，AF_INET或AF_INET6且类型参数为SOCK_RAW或未指定时，这是一个可能的值。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IPPROTO_IGMP</span><br><span class="line">    Internet组管理协议（IGMP）。 当af参数为AF_UNSPEC，AF_INET或AF_INET6且类型参数为SOCK_RAW或未指定时，这是一个可能的值。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IPPROTO_RM</span><br><span class="line">    用于可靠多播的PGM协议。 当af参数为AF_INET且类型参数为SOCK_RDM时，这是一个可能的值。 在针对Windows Vista及更高版本发布的Windows SDK上，此协议也称为IPPROTO_PGM。</span><br><span class="line">仅在安装了可靠多播协议时才支持此协议值。</span><br></pre></td></tr></table></figure>

<h4 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">成功-返回可用的socket</span><br><span class="line">失败-不用了一定要释放掉——closesocket(xxx);</span><br><span class="line">	然后再WSACleanup();清理网络库</span><br><span class="line">   	注意二者的先后顺序，一定要先释放,然后再清理网路库，</span><br><span class="line">    因为closesocket()是网络库中的函数。</span><br><span class="line">********************************************************************************</span><br><span class="line">失败——返回INVALID_SOCKET</span><br><span class="line">   <span class="keyword">if</span> (INVALID_SOCKET == socketServer)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();<span class="comment">//获取错误码</span></span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="comment">//获取错误码——int a = WSAGetLastError();</span></span><br><span class="line">   <span class="comment">//检测在它上面离它最近的错误码    </span></span><br></pre></td></tr></table></figure>

<h3 id="绑定地址与端口"><a href="#绑定地址与端口" class="headerlink" title="绑定地址与端口"></a>绑定地址与端口</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> sockaddr* addr,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> namelen</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>给我们的socket绑定端口号和具体地址</p>
<p><strong>地址</strong>：找到电脑，理论上只有一个。</p>
<p><strong>端口号</strong>：找到电脑上对应软件的具体功能，每个通信的端口号是唯一的，同一个软件可能占用多个端口号。</p>
<h4 id="参数1-2"><a href="#参数1-2" class="headerlink" title="参数1"></a>参数1</h4><p>传递上面创建好的socket</p>
<p>(scoket绑定好地址类型、socket类型，协议类型)</p>
<p>(bind绑定实质的地址、端口号)</p>
<h4 id="参数2-2"><a href="#参数2-2" class="headerlink" title="参数2"></a>参数2</h4><p><img src="/images/%E5%9F%BA%E4%BA%8ETCP-IP%E5%8D%8F%E8%AE%AE%E7%9A%84C-S%E6%A8%A1%E5%9E%8B.assets/image-20210824222808154.png" alt="image-20210824222808154"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> &#123;</span></span><br><span class="line">        ushort  sa_family;<span class="comment">//地址类型</span></span><br><span class="line">        <span class="keyword">char</span>    sa_data[<span class="number">14</span>];<span class="comment">//端口号 ip地址</span></span><br><span class="line">    <span class="comment">//往一个字符串中赋值端口号和ip地址不好赋所以给出sockaddr_in,与之对应</span></span><br><span class="line">&#125;;<span class="comment">//16个字节</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> &#123;</span></span><br><span class="line">        <span class="keyword">short</span>   sin_family;<span class="comment">//地址类型</span></span><br><span class="line">        u_short sin_port;<span class="comment">//端口号</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">in_addr</span> <span class="title">sin_addr</span>;</span><span class="comment">//ip地址,4字节</span></span><br><span class="line">        <span class="keyword">char</span>    sin_zero[<span class="number">8</span>];</span><br><span class="line">&#125;;<span class="comment">//16字节</span></span><br><span class="line"><span class="comment">//两个结构体大小和内存排布一样</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">结构体</span><br><span class="line">    -地址类型</span><br><span class="line">     -ip地址	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>-回送地址 本地回环地址 本地网络测试</span><br><span class="line">    		  <span class="number">192.168</span>.xxx.xxx- 用户ip地址</span><br><span class="line">     -端口号  就是一个整数，<span class="number">0</span>~<span class="number">65535</span>。<span class="keyword">unsigned</span> <span class="keyword">short</span></span><br><span class="line">    	理论上<span class="number">0</span>~<span class="number">65535</span>都可以，但是<span class="number">0</span>~<span class="number">1023</span>为系统保留占用端口号</span><br><span class="line">        	<span class="number">21</span>端口分配给FTP(文件传输协议)服务</span><br><span class="line">            <span class="number">25</span>端口分配给SMTP（简单邮件传输协议）服务</span><br><span class="line">            <span class="number">80</span>端口分配给HTTP服务</span><br><span class="line">    	所以真正的范围是<span class="number">1024</span>~<span class="number">65535</span></span><br><span class="line">      	端口是唯一的。</span><br><span class="line">    打开cmd，输入netstat -ano 查看被使用的所有端口</span><br><span class="line">    			netstat -aon|findstr <span class="string">&quot;12345&quot;</span>检查我们要使用的端口是否被占用</span><br><span class="line">    		</span><br><span class="line">SOCKETADDR_IN为sockaddr提供方便</span><br><span class="line">创建一个结构体SOCKETADDR_IN</span><br><span class="line">为其中的结构体成员赋值</span><br><span class="line">然后将它强转成sockaddr添加成功</span><br><span class="line"></span><br><span class="line">    SOCKADDR_IN si;</span><br><span class="line">	si.sin_family = AF_INET;<span class="comment">//地址类型</span></span><br><span class="line">	si.sin_port = htons(<span class="number">12345</span>);<span class="comment">//端口-将输入的unsigned short转换</span></span><br><span class="line">	si.sin_addr.S_un.S_addr = inet_addr(<span class="string">&quot;127,0,0,1&quot;</span>);<span class="comment">//ip地址</span></span><br><span class="line">	</span><br><span class="line">	bind(socketServer, (<span class="keyword">const</span> struct sockaddr*)&amp;si, <span class="keyword">sizeof</span>(si));</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">成功-返回<span class="number">0</span></span><br><span class="line">失败-失败 返回宏SOCKET_ERROR</span><br><span class="line">    		具体错误码通过WSAGetLastError()获得</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (SOCKET_ERROR == bind(socketServer, (<span class="keyword">const</span> struct sockaddr*)&amp;si, <span class="keyword">sizeof</span>(si)))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> a = WSAGetLastError();	</span><br><span class="line">	<span class="comment">//释放</span></span><br><span class="line">	closesocket(socketServer);</span><br><span class="line">	<span class="comment">//关闭网络库</span></span><br><span class="line">	WSACleanup();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="开始监听"><a href="#开始监听" class="headerlink" title="开始监听"></a>开始监听</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WSAAPI <span class="title">listen</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> backing</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen(socketServer, SOMAXCONN);</span><br></pre></td></tr></table></figure>



<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>将套接字置于正在侦听传入连接的状态。</p>
<h4 id="参数1-3"><a href="#参数1-3" class="headerlink" title="参数1"></a>参数1</h4><p>服务器端的socket,也就是socket函数创建的。</p>
<h4 id="参数2-3"><a href="#参数2-3" class="headerlink" title="参数2"></a>参数2</h4><p>挂起连接的最大长度。(排队等待区)休息区的长度。</p>
<p>可以手动设置，可能是2~10，一般是<strong>SOMAXCONN</strong>让系统自己选择最合适的个数。不同系统的环境不一样，所以这个合适的数也都不一样。</p>
<h4 id="WSAAPI"><a href="#WSAAPI" class="headerlink" title="WSAAPI"></a>WSAAPI</h4><p>调用约定，是给操作系统看的，我们可以忽略它。</p>
<p>决定-函数名字的编译方式-参数的入栈顺序-函数的调用时间。</p>
<h4 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">成功-返回<span class="number">0</span></span><br><span class="line">失败-返回宏SOCKET_ERROR</span><br><span class="line">     <span class="keyword">if</span> (SOCKET_ERROR == listen(socketServer, SOMAXCONN))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//出错了</span></span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		<span class="comment">//释放</span></span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		<span class="comment">//关闭网络库</span></span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建客户端socket-接收连接"><a href="#创建客户端socket-接收连接" class="headerlink" title="创建客户端socket/接收连接"></a>创建客户端socket/接收连接</h3><p>将每个客户端的信息都创建成一个socket。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SOCKET WSAAPI <span class="title">accept</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	sockaddr * addr,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> *addrlen</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h4><p>accept函数允许在套接字上进行传入连接尝试。</p>
<p>listen监听客户端来的链接，accept将客户端的信息绑定到一个socket上，也就是给客户端创建一个socket,通过返回值得到客户端socket。</p>
<p>一次只能创建一个(返回值1个),有几个客户端链接，就要调用几次。</p>
<h4 id="参数1-4"><a href="#参数1-4" class="headerlink" title="参数1"></a>参数1</h4><p>(服务器socket)</p>
<h4 id="参数2-4"><a href="#参数2-4" class="headerlink" title="参数2"></a>参数2</h4><p>客户端的地址端口信息结构体，同bind的第二个参数</p>
<p><strong>意义</strong>:系统帮我们监视着客户端的动态，肯定会记录客户端的信息，也就是IP地址，和端口号，并通过这个结构体记录。</p>
<p>只是这个我们不用自己填写结构体中的内容，<strong>系统帮我们填写</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建客户端</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clientMsg</span>;</span><span class="comment">//客户端信息</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">SOCKET socketClient = accept(socketServer, (struct sockaddr*)&amp;clientMsg, &amp;len);</span><br></pre></td></tr></table></figure>

<h4 id="参数3-1"><a href="#参数3-1" class="headerlink" title="参数3"></a>参数3</h4><p>参数2的大小</p>
<hr>
<p><strong>参数2、3也可以都写成NULL</strong>，那就是不直接得到客户端的地址、端口号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">可以通过</span><br><span class="line">    getpeername(newSocket, (struct sockaddr*)&amp;sockClient, &amp;nLen);</span><br><span class="line">得到客户端信息</span><br><span class="line">	通过</span><br><span class="line">    getsockname(sSocket, (sockaddr*)&amp;addr, &amp;nLen);</span><br><span class="line">得到本地服务器信息</span><br></pre></td></tr></table></figure>

<h4 id="返回值-4"><a href="#返回值-4" class="headerlink" title="返回值"></a>返回值</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">成功-返回客户端socket</span><br><span class="line">失败-INVALID_SOCKET</span><br><span class="line">    <span class="keyword">if</span> (socketClient == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		closesocket(socketClient);</span><br><span class="line">		WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="accept调试"><a href="#accept调试" class="headerlink" title="accept调试"></a>accept调试</h4><p>1.阻塞，同步，当服务器没有客户端链接时，它会一直等待。</p>
<p>2.多个链接，一次只能连接一个，5个就要循环5次。同时客户端socket也要创建成数组,否则上一个的socket就丢了。</p>
<h3 id="与客户端收发消息"><a href="#与客户端收发消息" class="headerlink" title="与客户端收发消息"></a>与客户端收发消息</h3><p>消息从谁那来，要发送给谁，就写谁的socket</p>
<h4 id="收"><a href="#收" class="headerlink" title="收"></a>收</h4><p>得到指定客户端(参数1)发来的消息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recv</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">char</span> *buf,<span class="comment">//消息，按字节</span></span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> len,<span class="comment">//长度</span></span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> flags</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例:</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">1500</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">int</span> res = recv(socketClient, buf, <span class="number">1499</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>本质就是复制。</p>
<p>数据的接收都是由协议本身做的，也就是socket的底层做的，系统会有一段缓冲区，存储着收到的数据。</p>
<p>recv的作用就是通过socket找到这个缓冲区，并把数据赋值进参数2。</p>
<h5 id="参数1-5"><a href="#参数1-5" class="headerlink" title="参数1"></a>参数1</h5><p>客户端的socket,每个客户端对应唯一的socket</p>
<h5 id="参数2-5"><a href="#参数2-5" class="headerlink" title="参数2"></a>参数2</h5><p>客户端消息的存储空间，是个字符数组，一般是1500字节。</p>
<p>网络传输的最大单元是1500字节，也就是客户端发过来的数据，一次最大就是1500字节，这是协议规定，很多情况总结出来的最优值。</p>
<h5 id="参数3-2"><a href="#参数3-2" class="headerlink" title="参数3"></a>参数3</h5><p>想要读取的字节个数。</p>
<p>一般是参数2的字节数-1，把/0字符串结尾留出来。</p>
<h5 id="参数4"><a href="#参数4" class="headerlink" title="参数4"></a>参数4</h5><p>数据的读取方式</p>
<p>一般就写个0。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line">正常逻辑(自然性质)</span><br><span class="line">    	从系统缓冲区里读，读走几个删几个，要不每次都从头开始读。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MSG_PEEK</span><br><span class="line">   		读完不删</span><br><span class="line">    	不建议使用</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MSG_OOB</span><br><span class="line">    	带外数据</span><br><span class="line">    	就是传输一段数据，在外带一个额外的特殊数据。(小声bb)</span><br><span class="line">    	不建议使用，读数据不行，无法计数。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSG_WAITALL</span><br><span class="line">    	直到系统缓冲区字节数满足参数<span class="number">3</span>所请求的字节数，才开始读取。</span><br></pre></td></tr></table></figure>

<h5 id="返回值-5"><a href="#返回值-5" class="headerlink" title="返回值"></a>返回值</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">返回读出来字节大小，读没了就在recv函数卡着，等着客户端发来数据，即阻塞，同步。死等</span><br><span class="line">客户端下线，返回<span class="number">0</span>。</span><br><span class="line">执行失败，返回SOCKET_ERROR    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (res == <span class="number">0</span>)<span class="comment">//客户端下线，链接中断</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;链接中断、客户端下线\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (res == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;出错了\n&quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		<span class="comment">//根据实际情况处理</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d  %s\n&quot;</span>, res, buf);</span><br><span class="line">	&#125; </span><br></pre></td></tr></table></figure>



<h4 id="发"><a href="#发" class="headerlink" title="发"></a>发</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WSAAPI <span class="title">send</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> <span class="keyword">char</span>* buf,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> len,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> flags</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a>作用</h5><p>向目标发送数据</p>
<p><strong>本质</strong>：send函数将我们的数据复制粘贴进系统的协议发送缓冲区，计算机伺机发出去。</p>
<p>传输单元是1500字节。</p>
<h5 id="参数1-6"><a href="#参数1-6" class="headerlink" title="参数1"></a>参数1</h5><p>目标的socket，每个客户端对应唯一的socket</p>
<h5 id="参数2-6"><a href="#参数2-6" class="headerlink" title="参数2"></a>参数2</h5><p>给对方发送的字节串。1500</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个大小不同的协议不一样，链路层<span class="number">14</span>字节，ip头<span class="number">20</span>字节，tcp头<span class="number">20</span>字节，数据结尾还要有状态确认，加起来也几十个字节，数据结尾还要要状态确认，加起来也几十个字节，所以实际的数据位，不能写<span class="number">1500</span>个，要留出来，例如<span class="number">1024</span>，或者最多写<span class="number">1400</span>，别多于<span class="number">1400</span>是最好的。</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">超过<span class="number">1500</span></span><br><span class="line">    系统会分片处理，比如<span class="number">2000</span>个字节</span><br><span class="line">    系统分成两个包，<span class="number">1400</span>+包头 == <span class="number">1500</span> 假设包头<span class="number">100</span>字节</span><br><span class="line">    				<span class="number">600</span>+包头 == <span class="number">700</span></span><br><span class="line">    				分两次发送出去</span><br><span class="line">    结果</span><br><span class="line">    	系统要分包再打包，再发送，客户端收到之后还得拆包，组合数据，从而增加了系统的工作，降低了效率。</span><br><span class="line">    	有的协议，就把分片后的二包直接丢了。</span><br></pre></td></tr></table></figure>

<h5 id="参数3-3"><a href="#参数3-3" class="headerlink" title="参数3"></a>参数3</h5><p>字节个数。1400</p>
<h5 id="参数4-1"><a href="#参数4-1" class="headerlink" title="参数4"></a>参数4</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line">MSG_OOB 同recv</span><br><span class="line">MSG_DIBTROUTE指定数据不应受路由限制，Windows套接字服务提供程序可以选择忽略此标志。</span><br></pre></td></tr></table></figure>

<h5 id="返回值-6"><a href="#返回值-6" class="headerlink" title="返回值"></a>返回值</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">成功-返回写入的字节数</span><br><span class="line">失败-返回SOCKET_ERROR</span><br><span class="line">    	WSAGetLastError()得到错误码</span><br><span class="line">    	根据错误码信息做相应处理</span><br><span class="line">    	-重启</span><br><span class="line">    	-等待</span><br><span class="line">    	-不用理会</span><br></pre></td></tr></table></figure>

<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//打开网络库 </span></span><br><span class="line">	WORD wdVersion = MAKEWORD(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">	WSADATA wdSockMsg;</span><br><span class="line">	<span class="keyword">int</span> nRes = WSAStartup(wdVersion,&amp;wdSockMsg);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (nRes != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;网络库打开失败&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//校验版本</span></span><br><span class="line">	<span class="keyword">if</span> (HIBYTE(wdSockMsg.wVersion) != <span class="number">2</span> || LOBYTE(wdSockMsg.wVersion) != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//说明版本不对</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;版本不对&quot;</span>);</span><br><span class="line">		WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建socket</span></span><br><span class="line">	SOCKET socketServer = socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (INVALID_SOCKET == socketServer)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;创建服务器socket失败&quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();<span class="comment">//获取错误码</span></span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN si;</span><br><span class="line">	si.sin_family = AF_INET;<span class="comment">//地址类型</span></span><br><span class="line">	si.sin_port = htons(<span class="number">12345</span>);<span class="comment">//端口-将输入的unsigned short转换</span></span><br><span class="line">	si.sin_addr.S_un.S_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//ip地址</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (SOCKET_ERROR == bind(socketServer, (<span class="keyword">const</span> struct sockaddr *)&amp;si, <span class="keyword">sizeof</span>(si)))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;绑定错误&quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//释放</span></span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		<span class="comment">//关闭网络库</span></span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开始监听</span></span><br><span class="line">	<span class="keyword">if</span> (SOCKET_ERROR == listen(socketServer, SOMAXCONN))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//出错了</span></span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		<span class="comment">//释放</span></span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		<span class="comment">//关闭网络库</span></span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建客户端</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clientMsg</span>;</span><span class="comment">//客户端信息</span></span><br><span class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(clientMsg);</span><br><span class="line">	SOCKET socketClient = accept(socketServer, (struct sockaddr*)&amp;clientMsg, &amp;len);</span><br><span class="line">	<span class="keyword">if</span> (socketClient == INVALID_SOCKET)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;客户端链接失败&quot;</span>);</span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		closesocket(socketClient);</span><br><span class="line">		WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;客户端链接成功\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//收发消息</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> sValue = send(socketClient, <span class="string">&quot;服务器链接成功&quot;</span>, <span class="keyword">sizeof</span>(<span class="string">&quot;服务器链接成功&quot;</span>), <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sValue == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		closesocket(socketClient);</span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">char</span> buf[<span class="number">1500</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="keyword">int</span> res = recv(socketClient, buf, <span class="number">50</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (res == <span class="number">0</span>)<span class="comment">//客户端下线，链接中断</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;链接中断、客户端下线\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (res == SOCKET_ERROR)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;出错了\n&quot;</span>);</span><br><span class="line">			<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">			<span class="comment">//根据实际情况处理</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;客户端说:	%d  %s\n&quot;</span>, res, buf);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">		send(socketClient, buf,<span class="built_in">strlen</span>(buf), <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	closesocket(socketServer);</span><br><span class="line">	closesocket(socketClient);</span><br><span class="line">	WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line"></span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">网络库头文件 网络库</span><br><span class="line">    打开网络库</span><br><span class="line">    校验版本</span><br><span class="line">    创建SOCKET</span><br></pre></td></tr></table></figure>

<h3 id="链接到服务器"><a href="#链接到服务器" class="headerlink" title="链接到服务器"></a>链接到服务器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> WSAAPI <span class="title">connect</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	SOCKET s,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">const</span> sockaddr* name,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span>	namelen</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serverMsg</span>;</span></span><br><span class="line">serverMsg.sin_family = AF_INET;</span><br><span class="line">serverMsg.sin_port = htons(<span class="number">12345</span>);<span class="comment">//转换成网络字节序</span></span><br><span class="line">serverMsg.sin_addr.S_un.S_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//服务器ip地址</span></span><br><span class="line"></span><br><span class="line">connect(socketServer, (struct sockaddr*)&amp;serverMsg, <span class="keyword">sizeof</span>(serverMsg));</span><br></pre></td></tr></table></figure>

<h4 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a>作用</h4><p>链接服务器并把服务器socket绑定到一起。</p>
<h4 id="参数1-7"><a href="#参数1-7" class="headerlink" title="参数1"></a>参数1</h4><p>服务器socket</p>
<h4 id="参数2-7"><a href="#参数2-7" class="headerlink" title="参数2"></a>参数2</h4><p>服务器ip地址端口号结构体</p>
<h4 id="参数3-4"><a href="#参数3-4" class="headerlink" title="参数3"></a>参数3</h4><p>参数2结构体大小</p>
<h4 id="返回值-7"><a href="#返回值-7" class="headerlink" title="返回值"></a>返回值</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">成功-返回<span class="number">0</span></span><br><span class="line">失败-返回SOCKET_ERROR</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<hr>
<p><strong>客户端与服务器收发消息，一发一接，一发一接，对应。</strong></p>
<hr>
<h3 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span>  comment(lib,<span class="meta-string">&quot;Ws2_32.lib&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	WORD wdVersion = MAKEWORD(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">	WSADATA wdSockMsg;</span><br><span class="line">	<span class="keyword">int</span> nRes = WSAStartup(wdVersion, &amp;wdSockMsg);</span><br><span class="line">	<span class="keyword">if</span> (nRes != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;网络库打开失败&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//校验版本</span></span><br><span class="line">	<span class="keyword">if</span> (HIBYTE(wdSockMsg.wVersion) != <span class="number">2</span> || LOBYTE(wdSockMsg.wVersion) != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//说明版本不对</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;版本不对&quot;</span>);</span><br><span class="line">		WSACleanup();<span class="comment">//清理网络库</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建的是服务器的，客户端不用创建自己的socket，因为链接服务器，服务器会创建出来客户端的socket</span></span><br><span class="line">	SOCKET socketServer = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line">	<span class="keyword">if</span> (INVALID_SOCKET == socketServer)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//链接服务器</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serverMsg</span>;</span></span><br><span class="line">	serverMsg.sin_family = AF_INET;</span><br><span class="line">	serverMsg.sin_port = htons(<span class="number">12345</span>);<span class="comment">//转换成网络字节序</span></span><br><span class="line">	serverMsg.sin_addr.S_un.S_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//服务器ip地址</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> cValue = connect(socketServer, (struct sockaddr*)&amp;serverMsg, <span class="keyword">sizeof</span>(serverMsg));</span><br><span class="line">	<span class="keyword">if</span> (cValue == SOCKET_ERROR)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">		closesocket(socketServer);</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//收发消息</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">char</span> buf[<span class="number">1500</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">		<span class="keyword">int</span> res = recv(socketServer, buf, <span class="number">50</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (res == <span class="number">0</span>)<span class="comment">//客户端下线，链接中断</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;链接中断、客户端下线\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (res == SOCKET_ERROR)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;出错了\n&quot;</span>);</span><br><span class="line">			<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">			<span class="comment">//根据实际情况处理</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;服务器说:	%d  %s\n&quot;</span>, res, buf);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">		<span class="keyword">int</span> sValue = send(socketServer, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (sValue == SOCKET_ERROR)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> a = WSAGetLastError();</span><br><span class="line">			closesocket(socketServer);</span><br><span class="line">			WSACleanup();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//清理网络库</span></span><br><span class="line">	closesocket(socketServer);</span><br><span class="line">	WSACleanup();</span><br><span class="line">	system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="延伸"><a href="#延伸" class="headerlink" title="延伸"></a>延伸</h2><p>由于accept，recv是阻塞的，做其中一件事，另一件事就做不了，等着接收客户端的消息-recv，这时来了个链接请求-accept无法处理。(没有目标的等待)</p>
<p>正确的处理方式是——哪个socket有请求就处理谁，得到连接请求，我们就直接accept,得到发来的消息，就recv。(有目的的等待，处理有请求的)</p>
<p>引出<strong>select模型</strong>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Do2eM0N</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://doraemon2.xyz/2021/08/26/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%9F%BA%E4%BA%8ETCPIP%E5%8D%8F%E8%AE%AE%E7%9A%84CS%E6%A8%A1%E5%9E%8B/">http://doraemon2.xyz/2021/08/26/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%9F%BA%E4%BA%8ETCPIP%E5%8D%8F%E8%AE%AE%E7%9A%84CS%E6%A8%A1%E5%9E%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://doraemon2.xyz" target="_blank">半生瓜のblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C%E8%AF%AD%E8%A8%80/">-C语言</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">-笔记</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">-网络编程</a></div><div class="post_share"><div class="social-share" data-image="/img/socket.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/28/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91select%E6%A8%A1%E5%9E%8B/"><img class="prev-cover" src="/img/socket.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【网络编程】select模型</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/21/LeetCode%E5%88%B7%E9%A2%98(14)%E3%80%90%E7%AE%80%E5%8D%95%E3%80%91%E5%8A%A0%E4%B8%80(C++)/"><img class="next-cover" src="/img/leetcode.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LeetCode刷题(14)【简单】加一(C++)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/08/28/【网络编程】select模型/" title="【网络编程】select模型"><img class="cover" src="/img/socket.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-28</div><div class="title">【网络编程】select模型</div></div></a></div><div><a href="/2021/09/04/【网络编程】事件选择模型/" title="【网络编程】事件选择模型"><img class="cover" src="/img/socket.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-04</div><div class="title">【网络编程】事件选择模型</div></div></a></div><div><a href="/2021/09/04/【网络编程】异步选择模型/" title="【网络编程】异步选择模型"><img class="cover" src="/img/socket.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-04</div><div class="title">【网络编程】异步选择模型</div></div></a></div><div><a href="/2021/03/15/C二级错题积累-1/" title="C二级错题积累(1)"><img class="cover" src="/img/cerji.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-15</div><div class="title">C二级错题积累(1)</div></div></a></div><div><a href="/2021/03/16/C二级错题积累-3/" title="C二级错题积累(3)"><img class="cover" src="/img/cerji.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-16</div><div class="title">C二级错题积累(3)</div></div></a></div><div><a href="/2021/03/15/C二级错题积累-2/" title="C二级错题积累(2)"><img class="cover" src="/img/cerji.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-15</div><div class="title">C二级错题积累(2)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/doraemon2.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Do2eM0N</div><div class="author-info__description">活着</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/94657270"><i class="iconfont icon-bilibili"></i><span>关注我一下吧</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=Mzg2MDU1ODAzNg==&amp;scene=124&amp;uin=&amp;key=&amp;devicetype=Windows+10+x64&amp;version=63010043&amp;lang=zh_CN&amp;a8scene=7&amp;fontgear=2" target="_blank" title="我的微信公众号"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://github.com/doraemon-hub-art" target="_blank" title="Github"><i class="iconfont icon-github-fill"></i></a><a class="social-icon" href="https://y.qq.com/portal/profile.html#stat=y_new.top.user_pic" target="_blank" title="QQ音乐"><i class="iconfont icon-QQMusic"></i></a><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1660219734&amp;site=qqq&amp;menu=yes" target="_blank" title="QQ"><i class="iconfont icon-a-qq"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_51604330?spm=1000.2115.3001.5343" target="_blank" title="我的CSDN博客"><i class="iconfont icon-csdn"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来访，网站正在建设中。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ETCP-IP%E5%8D%8F%E8%AE%AE%E7%9A%84C-S%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">基于TCP&#x2F;IP协议的C&#x2F;S模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-IP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.1.</span> <span class="toc-text">TCP&#x2F;IP协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-Server%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Client&#x2F;Server客户端&#x2F;服务器模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B%E4%B8%8Esocket%E7%BC%96%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">套接字编程与socket编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">1.5.</span> <span class="toc-text">服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%A4%B4%E6%96%87%E4%BB%B6-amp-%E7%BD%91%E7%BB%9C%E5%BA%93"><span class="toc-number">1.5.1.</span> <span class="toc-text">网络头文件&amp;网络库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%BD%91%E7%BB%9C%E5%BA%93"><span class="toc-number">1.5.2.</span> <span class="toc-text">打开网络库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.3.</span> <span class="toc-text">校验版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAsocket"><span class="toc-number">1.5.4.</span> <span class="toc-text">创建socket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsocket"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">什么是socket</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%84%8F%E4%B9%89"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">意义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E8%B4%A8"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">本质</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-1"><span class="toc-number">1.5.4.5.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-1"><span class="toc-number">1.5.4.6.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B03"><span class="toc-number">1.5.4.7.</span> <span class="toc-text">参数3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-1"><span class="toc-number">1.5.4.8.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%9C%B0%E5%9D%80%E4%B8%8E%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.5.5.</span> <span class="toc-text">绑定地址与端口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-2"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-2"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-2"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E7%9B%91%E5%90%AC"><span class="toc-number">1.5.6.</span> <span class="toc-text">开始监听</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-3"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-3"><span class="toc-number">1.5.6.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WSAAPI"><span class="toc-number">1.5.6.4.</span> <span class="toc-text">WSAAPI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-3"><span class="toc-number">1.5.6.5.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%A2%E6%88%B7%E7%AB%AFsocket-%E6%8E%A5%E6%94%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.7.</span> <span class="toc-text">创建客户端socket&#x2F;接收连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-4"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-4"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B03-1"><span class="toc-number">1.5.7.4.</span> <span class="toc-text">参数3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-4"><span class="toc-number">1.5.7.5.</span> <span class="toc-text">返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#accept%E8%B0%83%E8%AF%95"><span class="toc-number">1.5.7.6.</span> <span class="toc-text">accept调试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF"><span class="toc-number">1.5.8.</span> <span class="toc-text">与客户端收发消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B6"><span class="toc-number">1.5.8.1.</span> <span class="toc-text">收</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.8.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-5"><span class="toc-number">1.5.8.1.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-5"><span class="toc-number">1.5.8.1.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B03-2"><span class="toc-number">1.5.8.1.4.</span> <span class="toc-text">参数3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B04"><span class="toc-number">1.5.8.1.5.</span> <span class="toc-text">参数4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-5"><span class="toc-number">1.5.8.1.6.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91"><span class="toc-number">1.5.8.2.</span> <span class="toc-text">发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">1.5.8.2.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-6"><span class="toc-number">1.5.8.2.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-6"><span class="toc-number">1.5.8.2.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B03-3"><span class="toc-number">1.5.8.2.4.</span> <span class="toc-text">参数3</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B04-1"><span class="toc-number">1.5.8.2.5.</span> <span class="toc-text">参数4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-6"><span class="toc-number">1.5.8.2.6.</span> <span class="toc-text">返回值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">1.5.9.</span> <span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.6.</span> <span class="toc-text">客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">链接到服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B01-7"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">参数1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B02-7"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">参数2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B03-4"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">参数3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC-7"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%B6%E4%BC%B8"><span class="toc-number">1.7.</span> <span class="toc-text">延伸</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/09/24/C++%E8%99%9A%E5%87%BD%E6%95%B0%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/" title="C++虚函数知识点总结"><img src="/img/c++.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++虚函数知识点总结"/></a><div class="content"><a class="title" href="/2021/09/24/C++%E8%99%9A%E5%87%BD%E6%95%B0%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/" title="C++虚函数知识点总结">C++虚函数知识点总结</a><time datetime="2021-09-24T10:00:08.000Z" title="发表于 2021-09-24 18:00:08">2021-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/19/%E4%BD%8D%E5%9B%BE%E7%AE%97%E6%B3%95/" title="位图算法"><img src="/img/taohua.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="位图算法"/></a><div class="content"><a class="title" href="/2021/09/19/%E4%BD%8D%E5%9B%BE%E7%AE%97%E6%B3%95/" title="位图算法">位图算法</a><time datetime="2021-09-19T08:33:30.000Z" title="发表于 2021-09-19 16:33:30">2021-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/09/%E4%BE%AF%E6%8D%B7C++%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B(%E4%B8%8A)%E7%AC%94%E8%AE%B0/" title="侯捷C++面向对象高级编程(上)笔记"><img src="/img/c++.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="侯捷C++面向对象高级编程(上)笔记"/></a><div class="content"><a class="title" href="/2021/09/09/%E4%BE%AF%E6%8D%B7C++%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B(%E4%B8%8A)%E7%AC%94%E8%AE%B0/" title="侯捷C++面向对象高级编程(上)笔记">侯捷C++面向对象高级编程(上)笔记</a><time datetime="2021-09-09T07:47:43.000Z" title="发表于 2021-09-09 15:47:43">2021-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/04/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%BC%82%E6%AD%A5%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9E%8B/" title="【网络编程】异步选择模型"><img src="/img/socket.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【网络编程】异步选择模型"/></a><div class="content"><a class="title" href="/2021/09/04/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E5%BC%82%E6%AD%A5%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9E%8B/" title="【网络编程】异步选择模型">【网络编程】异步选择模型</a><time datetime="2021-09-04T12:56:28.000Z" title="发表于 2021-09-04 20:56:28">2021-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/04/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E4%BA%8B%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9E%8B/" title="【网络编程】事件选择模型"><img src="/img/socket.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【网络编程】事件选择模型"/></a><div class="content"><a class="title" href="/2021/09/04/%E3%80%90%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E3%80%91%E4%BA%8B%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A8%A1%E5%9E%8B/" title="【网络编程】事件选择模型">【网络编程】事件选择模型</a><time datetime="2021-09-04T03:47:05.000Z" title="发表于 2021-09-04 11:47:05">2021-09-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/socket.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Do2eM0N</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br>
<img src="https://z3.ax1x.com/2021/08/28/h3o6iT.png" alt="h3o6iT.png" border="0" />
<a href="https://beian.miit.gov.cn/#/Integrated/recordQuery"  style="color:#f72b07" target="_blank">京ICP备2021006139号</a></div><div class="footer_custom_text">欢迎来访</div><div id="running-time"><script>setInterval(()=>{let create_time=Math.round(new Date('2021-03-08 19:27:17').getTime()/1000);let timestamp=Math.round((new Date().getTime()+8*60*60*1000)/1000);let second=timestamp-create_time;let time=new Array(0,0,0,0,0);if(second>=365*24*3600){time[0]=parseInt(second/(365*24*3600));second%=365*24*3600;}if(second>=24*3600){time[1]=parseInt(second/(24*3600));second%=24*3600;}if(second>=3600){time[2]=parseInt(second/3600);second%=3600;}if(second>=60){time[3]=parseInt(second/60);second%=60;}if(second>0){time[4]=second;}currentTimeHtml='本站已安全运行 '+time[0]+' 年 '+time[1]+' 天 '+time[2]+' 时 '+time[3]+' 分 '+time[4]+' 秒';document.getElementById("running-time").innerHTML=currentTimeHtml;},1000);</script></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="/js/nobanner.js"></script><script src="/js/weather.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = '6KqzuZGb38hQrA6f6';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/C/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 C++ (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/C语言/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 C (15)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/网络编程/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 网络编程 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/hexo/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 Hexo (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/system/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 系统 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 算法 (9)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/计算机/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 计算机 (8)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://doraemon2.xyz/categories/数据结构/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 数据结构 (17)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="http://doraemon2.xyz/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: RGB(73,177,245)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
                        function butterfly_swiper_injector_config(){
                          var parent_div_git = document.getElementById('recent-posts');
                          var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2021/07/18/C语言实现学生成绩管理系统(EasyX图形窗口)/" alt=""><img width="48" height="48" src="/img/stuman2.png" alt=""/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-07-18</span><a class="blog-slider__title" href="2021/07/18/C语言实现学生成绩管理系统(EasyX图形窗口)/" alt="">C语言实现学生成绩管理系统(EasyX图形窗口)</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2021/07/18/C语言实现学生成绩管理系统(EasyX图形窗口)/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2021/08/26/【网络编程】基于TCPIP协议的CS模型/" alt=""><img width="48" height="48" src="/img/socket.png" alt=""/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-08-26</span><a class="blog-slider__title" href="2021/08/26/【网络编程】基于TCPIP协议的CS模型/" alt="">【网络编程】基于TCP/IP协议的C/S模型</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2021/08/26/【网络编程】基于TCPIP协议的CS模型/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2021/08/14/黑马程序员C++课程笔记总结/" alt=""><img width="48" height="48" src="/img/c++.png" alt=""/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-08-14</span><a class="blog-slider__title" href="2021/08/14/黑马程序员C++课程笔记总结/" alt="">黑马程序员C++课程笔记总结</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2021/08/14/黑马程序员C++课程笔记总结/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2021/06/17/Hexo-Butterfly添加天气插件/" alt=""><img width="48" height="48" src="/img/taohua.png" alt=""/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-06-17</span><a class="blog-slider__title" href="2021/06/17/Hexo-Butterfly添加天气插件/" alt="">Hexo-Butterfly添加天气插件</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="2021/06/17/Hexo-Butterfly添加天气插件/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
                          console.log('已挂载butterfly_swiper')
                          // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                          parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
                          }
                        if( document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
                        butterfly_swiper_injector_config()
                        }
                      </script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.6/js/swiper.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>